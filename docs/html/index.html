<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>binlex: binlex</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">binlex
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('index.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">binlex </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h2>A Genetic Binary Trait Lexer Library and Utility</h2>
<p>The purpose of <code>binlex</code> is to extract basic blocks and functions as traits from binaries for malware research, hunting and detection.</p>
<p>Most projects attempting this use Python to generate traits, but it is very slow.</p>
<p>The design philosophy behind <code>binlex</code> is it to keep it simple and extendable.</p>
<p>The simple command-line interface allows malware researchers and analysts to hunt traits across hundreds or thousands of potentially similar malware saving time and money in production environments.</p>
<p>While the C++ API allows developers to get creative with their own detection solutions, completely unencumbered by license limitations.</p>
<p>To help combat malware, we firmly commit our work to the public domain for the greater good of the world.</p>
<p><a href="https://ci.appveyor.com/project/c3rb3ru5d3d53c/binlex"><img src="https://ci.appveyor.com/api/projects/status/wa423scoigl7xh7x/branch/master?svg=true" alt="Build status" class="inline"/></a> <img src="https://img.shields.io/badge/os-linux-brightgreen" alt="OS Linux" class="inline"/> <img src="https://img.shields.io/badge/os-windows-brightgreen" alt="OS Windows" class="inline"/> <a href="https://github.com/c3rb3ru5d3d53c/binlex/stargazers"><img src="https://img.shields.io/github/stars/c3rb3ru5d3d53c/binlex" alt="GitHub stars" class="inline"/></a> <a href="https://github.com/c3rb3ru5d3d53c/binlex/network"><img src="https://img.shields.io/github/forks/c3rb3ru5d3d53c/binlex" alt="GitHub forks" class="inline"/></a> <a href="https://discord.gg/UDBfRpxV3B"><img src="https://img.shields.io/discord/915569998469144636?logo=discord" alt="Discord Status" class="inline"/></a> <a href="https://github.com/c3rb3ru5d3d53c/binlex/blob/master/LICENSE"><img src="https://img.shields.io/github/license/c3rb3ru5d3d53c/binlex" alt="GitHub license" class="inline"/></a> <img src="https://img.shields.io/github/downloads/c3rb3ru5d3d53c/binlex/total" alt="GitHub all releases" class="inline"/></p>
<h1><a class="anchor" id="autotoc_md1"></a>
Demos</h1>
<p><img src="docs/img/demo_0.gif" alt="animated" class="inline"/> </p>
<p><a href="https://www.youtube.com/watch?v=hgz5gZB3DxE" target="_blank"><img src="https://img.youtube.com/vi/hgz5gZB3DxE/0.jpg" alt="Introduction Video" class="inline"/> </a> </p>
<p>Get slides <a href="docs/oalabs.pdf">here</a>.</p>
<h1><a class="anchor" id="autotoc_md2"></a>
Use Cases</h1>
<ul>
<li>YARA Signature Creation/Automation</li>
<li>Identifying Code-Reuse</li>
<li>Threat Hunting</li>
<li>Building Goodware Trait Corpus</li>
<li>Building Malware Trait Corpus</li>
<li>Genetic Programming</li>
<li>Machine Learning Malware Detection</li>
</ul>
<h1><a class="anchor" id="autotoc_md3"></a>
Installation</h1>
<p><b>Dependencies:</b></p>
<p>To get started you will need the following dependencies for <code>binlex</code>.</p>
<div class="fragment"><div class="line">sudo apt install -y git build-essential \</div>
<div class="line">                    cmake make parallel \</div>
<div class="line">                    doxygen git-lfs rpm \</div>
<div class="line">                    python3 python3-dev</div>
<div class="line">git clone --recursive https://github.com/c3rb3ru5d3d53c/binlex.git</div>
<div class="line">cd binlex/</div>
</div><!-- fragment --><p><em>NOTE: that <code>binlex</code> requires <code>cmake</code> &gt;= 3.5, <code>make</code> &gt;= 4.2.1 and <code>ubuntu</code> &gt;= 20.04.</em></p>
<p>Once you have installed, cloned and changed your directory to the project directory, we can continue with installation.</p>
<p><b>From Source:</b></p>
<p>If you want to compile and install via <code>make install</code> run the following commands:</p>
<div class="fragment"><div class="line">make threads=4</div>
<div class="line">sudo make install</div>
<div class="line"> </div>
<div class="line"># Test your Install</div>
<div class="line">binlex -m auto -i tests/elf/elf.x86</div>
</div><!-- fragment --><p><b>Binary Releases:</b></p>
<p>See the <a href="https://github.com/c3rb3ru5d3d53c/binlex/releases"><code>releases</code></a> page.</p>
<p>If you need the bleeding edge binaries you can download them from our AppVeyor CI/CD <a href="https://ci.appveyor.com/project/c3rb3ru5d3d53c/binlex/branch/master"><code>here</code></a>.</p>
<p><em>NOTE: bleeding edge binaries are subject to bugs, if you encounter one, please let us know!</em></p>
<p><b>Test Files:</b></p>
<ul>
<li>To download all the test samples do the command <code>git lfs fetch</code></li>
<li>ZIP files in the <code>tests/</code> directory can then be extracted using the password <code>infected</code></li>
</ul>
<p><em>NOTE: The <code>tests/</code> directory contains malware, we assume you know what you are doing.</em></p>
<p>To download individual <code>git-lfs</code> files from a relative path, you can use the following <code>git</code> alias in <code>~/.gitconfig</code>:</p>
<div class="fragment"><div class="line">[alias]</div>
<div class="line">download = &quot;!ROOT=$(git rev-parse --show-toplevel); cd $ROOT; git lfs pull --include $GIT_PREFIX$1; cd $ROOT/$GIT_PREFIX&quot;</div>
</div><!-- fragment --><p>You will then be able to do the following:</p>
<div class="fragment"><div class="line">git download tests/pe/pe.zip</div>
</div><!-- fragment --><p><b>Building Packages:</b></p>
<p>Additionally, another option is to build Debian binary packages for and install those.</p>
<p>To build packages use <code>cpack</code>, which comes with <code>cmake</code>.</p>
<div class="fragment"><div class="line">make threads=4</div>
<div class="line">make pkg  # builds binary packages</div>
<div class="line">make dist # builds source packages</div>
<div class="line">sudo apt install ./build/binlex_1.1.1_amd64.deb</div>
<div class="line">binlex -m elf:x86 -i tests/elf/elf.x86</div>
</div><!-- fragment --><p>You will then be provided with <code>.deb</code>, <code>.rpm</code> and <code>.tar.gz</code> packages for <code>binlex</code>.</p>
<p><b>Building Python Bindings:</b></p>
<p>To get started using <code>pybinlex</code>: </p><div class="fragment"><div class="line">virtualenv -p python3 venv</div>
<div class="line">source venv/bin/activate</div>
<div class="line"># Install Library</div>
<div class="line">pip install -v .</div>
<div class="line"># Build Wheel Package</div>
<div class="line">pip wheel -v -w build/ .</div>
<div class="line">python3</div>
<div class="line">&gt;&gt;&gt; import pybinlex</div>
</div><!-- fragment --><p>If you wish to compile the bindings with <code>cmake</code>: </p><div class="fragment"><div class="line">make python</div>
</div><!-- fragment --><p><em>NOTE: we use <code>pybind11</code> and support for <code>python3.9</code> is experimental.</em></p>
<p>Examples of how to use <code>pybinlex</code> can be found in <code>tests/tests.py</code>.</p>
<h1><a class="anchor" id="autotoc_md4"></a>
Building Binlex Platform:</h1>
<p><b>Install Dependencies:</b></p>
<div class="fragment"><div class="line">sudo apt install docker.io make</div>
<div class="line">sudo usermod -a -G docker $USER</div>
<div class="line">sudo systemctl enable docker</div>
<div class="line">reboot # ensures your user is added to the docker group</div>
</div><!-- fragment --><p><b>Building Containers:</b></p>
<div class="fragment"><div class="line">make docker        # generate docker-compose.yml and config files</div>
<div class="line"># Your generated credentials will be printed to the screen and saved in config/credentials.txt</div>
<div class="line">make docker-build  # build the images (can take a long time, go get a coffee!)</div>
<div class="line">make docker-start  # start the containers</div>
<div class="line">make docker-init   # initialize all databases and generated configurations</div>
<div class="line">make docker-logs   # tail all logs</div>
</div><!-- fragment --><p>If you wish to change the auto-generated initial username and passwords, you can run <code>./docker.sh</code> with additional parameters.</p>
<p>To see what parameters are available to you, run <code>./docker.sh --help</code>.</p>
<p><b>Platform URLs:</b></p>
<ul>
<li>HTTP API <code><a href="https://127.0.0.1:8443">https://127.0.0.1:8443</a></code> (API Docs)</li>
<li>RabbitMQ <code><a href="https://127.0.0.1:15672/">https://127.0.0.1:15672/</a></code> (Messaging)</li>
<li>MinIO <code><a href="https://127.0.0.1:9001/">https://127.0.0.1:9001/</a></code> (Object Store)</li>
<li>MongoDB <code>mongodb://&lt;user&gt;:&lt;pass&gt;@127.0.0.1</code> (MongoDB)<ul>
<li>User <code>mongodb://binlex:&lt;generated-password&gt;@127.0.0.1/?authSource=binlex</code> (for trait collection)</li>
<li>Admin <code>mongodb://admin:&lt;generated-password&gt;@127.0.0.1</code> (for administration)</li>
</ul>
</li>
</ul>
<p><b>Example HTTP API Requests:</b> </p><div class="fragment"><div class="line"># Get Version</div>
<div class="line">curl --insecure -H &quot;X-API-Key: &lt;key&gt;&quot; https://127.0.0.1:8443/binlex/api/v1/version</div>
<div class="line"> </div>
<div class="line"># Upload Sample</div>
<div class="line">curl -X POST --insecure -H &quot;X-API-Key: &lt;key&gt;&quot; --upload-file &lt;file&gt; https://127.0.0.1:8443/binlex/api/v1/samples/&lt;corpus&gt;/&lt;mode&gt;</div>
<div class="line"> </div>
<div class="line"># List Corpra</div>
<div class="line">curl -X GET --insecure -H &quot;X-API-Key: &lt;key&gt;&quot; https://127.0.0.1:8443/binlex/api/v1/corpra</div>
<div class="line"> </div>
<div class="line"># Get Supported Modes</div>
<div class="line">curl -X GET --insecure -H &quot;X-API-Key: &lt;key&gt;&quot; https://127.0.0.1:8443/binlex/api/v1/modes</div>
<div class="line"> </div>
<div class="line"># Download Sample by SHA256</div>
<div class="line">curl -X GET --insecure -H &quot;X-API-Key: &lt;key&gt;&quot; https://127.0.0.1:8443/binlex/api/v1/samples/&lt;sha256&gt;</div>
</div><!-- fragment --><p>If you work with a team of malware analysts or malware researchers, you create read-only accounts for them.</p>
<p>This will ensure they can do advanced queries to hunt and write detection signatures.</p>
<p>Adding New Read-Only Users to MongoDB: </p><div class="fragment"><div class="line">cd scripts/</div>
<div class="line">./mongodb-createuser.sh mongodb-router1 &lt;username&gt; &lt;password&gt;</div>
</div><!-- fragment --><p>If you have a VERY large team, you can script creation of these accounts.</p>
<h1><a class="anchor" id="autotoc_md5"></a>
CLI Usage</h1>
<div class="fragment"><div class="line">binlex v1.1.1 - A Binary Genetic Traits Lexer</div>
<div class="line">  -i  --input           input file              (required)</div>
<div class="line">  -m  --mode            set mode                (optional)</div>
<div class="line">  -lm --list-modes      list modes              (optional)</div>
<div class="line">      --instructions    include insn traits     (optional)</div>
<div class="line">  -c  --corpus          corpus name             (optional)</div>
<div class="line">  -g  --tag             add a tag               (optional)</div>
<div class="line">                        (can be specified multiple times)</div>
<div class="line">  -t  --threads         number of threads       (optional)</div>
<div class="line">  -to --timeout         execution timeout in s  (optional)</div>
<div class="line">  -h  --help            display help            (optional)</div>
<div class="line">  -o  --output          output file             (optional)</div>
<div class="line">  -p  --pretty          pretty output           (optional)</div>
<div class="line">  -d  --debug           print debug info        (optional)</div>
<div class="line">  -v  --version         display version         (optional)</div>
<div class="line">Author: @c3rb3ru5d3d53c</div>
</div><!-- fragment --><p><b>Supported Modes</b></p>
<ul>
<li><code>elf:x86</code></li>
<li><code>elf:x86_64</code></li>
<li><code>pe:x86</code></li>
<li><code>pe:x86_64</code></li>
<li><code>pe:cil</code></li>
<li><code>raw:x86</code></li>
<li><code>raw:x86_64</code></li>
<li><code>raw:cil</code></li>
<li><code>auto</code></li>
</ul>
<p><em>NOTE: The <code>raw</code> modes can be used on shellcode.</em></p>
<p><em>NOTE: The <code>auto</code> mode cannot be used on shellcode.</em></p>
<p><b>Advanced</b></p>
<p>If you are hunting using <code>binlex</code> you can use <code>jq</code> to your advantage for advanced searches.</p>
<div class="fragment"><div class="line">build/binlex -m auto -i tests/pe/pe.x86 | jq -r &#39;select((.size &gt; 8 and .size &lt; 16) and (.bytes_sha256 != .traits.sha256)) | .trait&#39; | head -10</div>
<div class="line">8b 48 ?? 03 c8 81 39 50 45 00 00 75 12</div>
<div class="line">0f b7 41 ?? 3d 0b 01 00 00 74 1f</div>
<div class="line">83 b9 ?? ?? ?? ?? ?? 76 f2</div>
<div class="line">33 c0 39 b9 ?? ?? ?? ?? eb 0e</div>
<div class="line">83 4d ?? ?? b8 ff 00 00 00 e9 ba 00 00 00</div>
<div class="line">89 75 ?? 66 83 3e 22 75 45</div>
<div class="line">03 f3 89 75 ?? 66 8b 06 66 3b c7 74 06</div>
<div class="line">03 f3 89 75 ?? 66 8b 06 66 3b c7 74 06</div>
<div class="line">56 ff 15 ?? ?? ?? ?? ff 15 ?? ?? ?? ?? eb 2d</div>
<div class="line">55 8b ec 51 56 33 f6 66 89 33 8a 07 eb 29</div>
</div><!-- fragment --><p>Here are examples of additional queries.</p>
<div class="fragment"><div class="line"># Block traits with a size between 0 and 32 bytes</div>
<div class="line">jq -r &#39;select(.type == &quot;block&quot; and .size &lt; 32 and .size &gt; 0)&#39;</div>
<div class="line"># Function traits with a cyclomatic complexity greater than 32 (maybe obfuscation)</div>
<div class="line">jq -r &#39;select(.type == &quot;function&quot; and .cyclomatic_complexity &gt; 32)&#39;</div>
<div class="line"># Traits where bytes have high entropy</div>
<div class="line">jq -r &#39;select(.bytes_entropy &gt; 7)&#39;</div>
<div class="line"># Output all trait strings only</div>
<div class="line">jq -r &#39;.trait&#39;</div>
<div class="line"># Output only trait hashes</div>
<div class="line">jq -r &#39;.trait_sha256&#39;</div>
</div><!-- fragment --><p>If you output just traits you want to <code>stdout</code> you can do build a <code>yara</code> signature on the fly with the included tool <code>blyara</code>:</p>
<div class="fragment"><div class="line">build/binlex -m raw:x86 -i tests/raw/raw.x86 | jq -r &#39;select(.size &gt; 16 and .size &lt; 32) | .trait&#39; | build/blyara --name example_0 -m author example -m tlp white -c 1</div>
<div class="line">rule example_0 {</div>
<div class="line">    metadata:</div>
<div class="line">        author = &quot;example&quot;</div>
<div class="line">        tlp = &quot;white&quot;</div>
<div class="line">    strings:</div>
<div class="line">        trait_0 = {52 57 8b 52 ?? 8b 42 ?? 01 d0 8b 40 ?? 85 c0 74 4c}</div>
<div class="line">        trait_1 = {49 8b 34 8b 01 d6 31 ff 31 c0 c1 cf ?? ac 01 c7 38 e0 75 f4}</div>
<div class="line">        trait_2 = {e8 67 00 00 00 6a 00 6a ?? 56 57 68 ?? ?? ?? ?? ff d5 83 f8 00 7e 36}</div>
<div class="line">    condition:</div>
<div class="line">        1 of them</div>
<div class="line">}</div>
</div><!-- fragment --><p>You can also use the switch <code>--pretty</code> to output <code>json</code> to identify more properies to query.</p>
<div class="fragment"><div class="line">build/binlex -m auto -i tests/pe/pe.emotet.x86 -c malware -g malware:emotet -g malware:loader | head -1 | jq</div>
<div class="line">{</div>
<div class="line">  &quot;average_instructions_per_block&quot;: 29,</div>
<div class="line">  &quot;blocks&quot;: 1,</div>
<div class="line">  &quot;bytes&quot;: &quot;55 8b ec 83 ec 1c 83 65 f0 00 33 d2 c7 45 e4 68 5d df 00 c7 45 e8 43 c4 cb 00 c7 45 ec 8f 08 46 00 c7 45 f8 06 3b 43 00 81 45 f8 25 7a ff ff 81 75 f8 30 f4 44 00 c7 45 fc 22 51 53 00 8b 45 fc 6a 3f 59 f7 f1 6a 1c 89 45 fc 33 d2 8b 45 fc 59 f7 f1 89 45 fc 81 75 fc 3c 95 0e 00 c7 45 f4 0b 16 11 00 81 45 f4 e1 21 ff ff 81 75 f4 79 bd 15 00 ff 4d 0c 75 21&quot;,</div>
<div class="line">  &quot;bytes_entropy&quot;: 5.333979606628418,</div>
<div class="line">  &quot;bytes_sha256&quot;: &quot;13e0463c5837bc5ce110990d69397662b82b8de8a9971f77b237f2a6dd2d8982&quot;,</div>
<div class="line">  &quot;corpus&quot;: &quot;malware&quot;,</div>
<div class="line">  &quot;cyclomatic_complexity&quot;: 3,</div>
<div class="line">  &quot;edges&quot;: 2,</div>
<div class="line">  &quot;file_sha256&quot;: &quot;7b01c7c835552b17f17ad85b8f900c006dd8811d708781b5f49f231448aaccd3&quot;,</div>
<div class="line">  &quot;file_tlsh&quot;: &quot;42E34A10F3D341F7DC9608F219B6B22F9F791E023124DFA987981F57ADB5246A2B981C&quot;,</div>
<div class="line">  &quot;instructions&quot;: 29,</div>
<div class="line">  &quot;invalid_instructions&quot;: 0,</div>
<div class="line">  &quot;mode&quot;: &quot;pe:x86&quot;,</div>
<div class="line">  &quot;offset&quot;: 49711,</div>
<div class="line">  &quot;size&quot;: 118,</div>
<div class="line">  &quot;tags&quot;: [</div>
<div class="line">    &quot;malware:emotet&quot;,</div>
<div class="line">    &quot;malware:loader&quot;</div>
<div class="line">  ],</div>
<div class="line">  &quot;trait&quot;: &quot;55 8b ec 83 ec 1c 83 65 ?? ?? 33 d2 c7 45 ?? ?? ?? ?? ?? c7 45 ?? ?? ?? ?? ?? c7 45 ?? ?? ?? ?? ?? c7 45 ?? ?? ?? ?? ?? 81 45 ?? ?? ?? ?? ?? 81 75 ?? ?? ?? ?? ?? c7 45 ?? ?? ?? ?? ?? 8b 45 ?? 6a 3f 59 f7 f1 6a 1c 89 45 ?? 33 d2 8b 45 ?? 59 f7 f1 89 45 ?? 81 75 ?? ?? ?? ?? ?? c7 45 ?? ?? ?? ?? ?? 81 45 ?? ?? ?? ?? ?? 81 75 ?? ?? ?? ?? ?? ff 4d ?? 75 21&quot;,</div>
<div class="line">  &quot;trait_entropy&quot;: 3.9699645042419434,</div>
<div class="line">  &quot;trait_sha256&quot;: &quot;7b04c2dbcc3cf23abfdd457b592b4517e4d98b5c83e692c836cde5b91899dd68&quot;,</div>
<div class="line">  &quot;type&quot;: &quot;block&quot;</div>
<div class="line">}</div>
</div><!-- fragment --><p>If you have terabytes of executable files, we can leverage the power of <code>parallel</code> to generate traits for us.</p>
<div class="fragment"><div class="line">make traits source=samples/malware/pe/x32/ dest=dist/ type=malware format=pe arch=x86 threads=4</div>
<div class="line">make traits-combine source=dist/ dest=dist/ type=malware format=pe arch=x86 threads=4</div>
</div><!-- fragment --><p>It also allows you to name your type of dataset, i.e. goodware/malware/riskware/pua etc...</p>
<p>With <code>binlex</code> it is up to you to remove goodware traits from your extracted traits.</p>
<p>There have been many questions about removing "library code", there is a make target shown below to help you with this.</p>
<div class="fragment"><div class="line">make traits-clean remove=goodware.traits source=sample.traits dest=malware.traits</div>
</div><!-- fragment --><p>With <code>binlex</code> the power is in your hands, "With great power comes great responsibility", it is up to you!</p>
<p><b>Plugins:</b></p>
<p>There has been some interest in making IDA, Ghidra and Cutter plugins for <code>binlex</code>.</p>
<p>This is something that will be started soon as we finish the HTTP API endpoints.</p>
<p>This <code>README.md</code> will be updated when they are ready to use.</p>
<p><b>General Usage Information:</b></p>
<p>Binlex is designed to do one thing and one thing only, extract genetic traits from executable code in files. This means it is up to you "the researcher" / "the data scientist" to determine which traits are good and which traits are bad. To accomplish this, you need to use your own <a href="https://en.wikipedia.org/wiki/Fitness_function">fitness function</a>. I encourage you to read about <a href="https://en.wikipedia.org/wiki/Genetic_programming">genetic programming</a> to gain a better understanding of this in practice. Perhaps watching <a href="https://www.youtube.com/watch?v=qiKW1qX97qA">this</a> introductory video will help your understanding.</p>
<p>Again, <b>it's up to you to implement your own algorithms for detection based on the genetic traits you extract</b>.</p>
<h1><a class="anchor" id="autotoc_md6"></a>
Trait Format</h1>
<p>Traits will contain binary code represented in hexadecimal form and will use <code>??</code> as wild cards for memory operands or other operands subject to change.</p>
<p>They will also contain additional properties about the trait including its <code>offset</code>, <code>edges</code>, <code>blocks</code>, <code>cyclomatic_complexity</code>, <code>average_instruction_per_block</code>, <code>bytes</code>, <code>trait</code>, <code>trait_sha256</code>, <code>bytes_sha256</code>, <code>trait_entropy</code>, <code>bytes_entropy</code>, <code>type</code>, <code>size</code>, <code>invalid_instructions</code> and <code>instructions</code>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  &quot;average_instructions_per_block&quot;: 6,</div>
<div class="line">  &quot;blocks&quot;: 1,</div>
<div class="line">  &quot;bytes&quot;: &quot;8b 45 08 a3 10 52 02 10 8b 45 f8 e8 fb d7 00 00 85 c0 74 0d&quot;,</div>
<div class="line">  &quot;bytes_entropy&quot;: 3.9219279289245605,</div>
<div class="line">  &quot;bytes_sha256&quot;: &quot;435cb166701006282e457d441ca793e795e38790cacc5b250d4bc418a28961c3&quot;,</div>
<div class="line">  &quot;corpus&quot;: &quot;malware&quot;,</div>
<div class="line">  &quot;cyclomatic_complexity&quot;: 3,</div>
<div class="line">  &quot;edges&quot;: 2,</div>
<div class="line">  &quot;file_sha256&quot;: &quot;7b01c7c835552b17f17ad85b8f900c006dd8811d708781b5f49f231448aaccd3&quot;,</div>
<div class="line">  &quot;file_tlsh&quot;: &quot;42E34A10F3D341F7DC9608F219B6B22F9F791E023124DFA987981F57ADB5246A2B981C&quot;,</div>
<div class="line">  &quot;instructions&quot;: 6,</div>
<div class="line">  &quot;invalid_instructions&quot;: 0,</div>
<div class="line">  &quot;mode&quot;: &quot;pe:x86&quot;,</div>
<div class="line">  &quot;offset&quot;: 49829,</div>
<div class="line">  &quot;size&quot;: 20,</div>
<div class="line">  &quot;tags&quot;: [</div>
<div class="line">    &quot;malware:emotet&quot;,</div>
<div class="line">    &quot;malware:loader&quot;</div>
<div class="line">  ],</div>
<div class="line">  &quot;trait&quot;: &quot;8b 45 ?? a3 ?? ?? ?? ?? 8b 45 ?? e8 fb d7 00 00 85 c0 74 0d&quot;,</div>
<div class="line">  &quot;trait_entropy&quot;: 3.3787841796875,</div>
<div class="line">  &quot;trait_sha256&quot;: &quot;fe3b057a28b40a02ac9dd2db6c3208f96f7151fb912fb3c562a7b4581bb7f7a0&quot;,</div>
<div class="line">  &quot;type&quot;: &quot;block&quot;</div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md7"></a>
Documentation</h1>
<p>Public documentation on <code>binlex</code> can be viewed <a href="https://c3rb3ru5d3d53c.github.io/binlex/html/index.html">here</a>.</p>
<h1><a class="anchor" id="autotoc_md8"></a>
Building Docs</h1>
<p>You can access the C++ API Documentation and everything else by building the documents using <code>doxygen</code>.</p>
<div class="fragment"><div class="line">make docs threads=4</div>
</div><!-- fragment --><p>The documents will be available at <code>build/docs/html/index.html</code>.</p>
<h1><a class="anchor" id="autotoc_md9"></a>
C++ API Example Code</h1>
<p>The power of detection is in your hands, <code>binlex</code> is a framework, leverage the C++ API.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;binlex/pe.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;binlex/decompiler.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">using namespace </span><a class="code" href="namespacebinlex.html">binlex</a>;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv){</div>
<div class="line">  <a class="code" href="classbinlex_1_1PE.html">PE</a> pe32;</div>
<div class="line">  <span class="keywordflow">if</span> (pe32.<a class="code" href="classbinlex_1_1PE.html#aaf2fa4d79bc0fc9449eadd366b870d6b">Setup</a>(MACHINE_TYPES::IMAGE_FILE_MACHINE_I386) == <span class="keyword">false</span>){</div>
<div class="line">      <span class="keywordflow">return</span> EXIT_FAILURE;</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">if</span> (pe32.<a class="code" href="classbinlex_1_1File.html#af69581745439422e597e9c8ab2dcb27c">ReadFile</a>(argv[1]) == <span class="keyword">false</span>){</div>
<div class="line">      <span class="keywordflow">return</span> EXIT_FAILURE;</div>
<div class="line">  }</div>
<div class="line">  <a class="code" href="classbinlex_1_1Decompiler.html">Decompiler</a> decompiler(pe32);</div>
<div class="line">  decompiler.Setup(CS_ARCH_X86, CS_MODE_32);</div>
<div class="line">  <span class="keywordflow">for</span> (uint32_t i = 0; i &lt; pe32.total_exec_sections; i++){</div>
<div class="line">      decompiler.AppendQueue(pe32.sections[i].functions, DECOMPILER_OPERAND_TYPE_FUNCTION, i);</div>
<div class="line">      decompiler.Decompile(pe32.sections[i].data, pe32.sections[i].size, pe32.sections[i].offset, i);</div>
<div class="line">  }</div>
<div class="line">  decompiler.WriteTraits();</div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md10"></a>
Python API Example Code</h1>
<p>The power of detection is in your hands, <code>binlex</code> is a framework, leverage the C++ API.</p>
<div class="fragment"><div class="line">#!/usr/bin/env python</div>
<div class="line"> </div>
<div class="line">import pybinlex</div>
<div class="line">from hashlib import sha256</div>
<div class="line"> </div>
<div class="line">pe = pybinlex.PE()</div>
<div class="line">pe.setup(pybinlex.MACHINE_TYPES.IMAGE_FILE_MACHINE_I386)</div>
<div class="line">result = pe.read_file(&#39;../tests/pe/pe.x86&#39;)</div>
<div class="line">if result is False:</div>
<div class="line">    print(&quot;[x] failed to read pe.x86&quot;)</div>
<div class="line">    sys.exit(1)</div>
<div class="line">pe_sections = pe.get_sections()</div>
<div class="line"> </div>
<div class="line">decompiler = pybinlex.Decompiler(pe)</div>
<div class="line">decompiler.setup(pybinlex.cs_arch.CS_ARCH_X86, pybinlex.cs_mode.CS_MODE_32)</div>
<div class="line">for i in range(0, len(pe_sections)):</div>
<div class="line">    decompiler.append_queue(pe_sections[i][&#39;functions&#39;], pybinlex.DECOMPILER_OPERAND_TYPE.DECOMPILER_OPERAND_TYPE_FUNCTION, i)</div>
<div class="line">    decompiler.decompile(pe_sections[i][&#39;data&#39;], pe_sections[i][&#39;offset&#39;], i)</div>
<div class="line">traits = decompiler.get_traits()</div>
<div class="line">print(json.dumps(traits, indent=4))</div>
</div><!-- fragment --><p>We hope this encourages people to build their own detection solutions based on binary genetic traits.</p>
<h1><a class="anchor" id="autotoc_md11"></a>
Tips</h1>
<ul>
<li>If you are hunting be sure to use <code>jq</code> to improve your searches</li>
<li>Does not support PE files that are VB6 if you run against these you will get errors</li>
<li>Don't mix packed and unpacked malware or you will taint your dataset (seen this in academics all the time)</li>
<li>When comparing samples to identify if their code is similar, DO NOT mix their architectures in your comparison<ul>
<li>Comparing CIL byte-code or .NET to x86 machine code may yield interesting properties, but they are invalid</li>
</ul>
</li>
<li>Verify the samples you are collecting into a group using skilled analysts</li>
<li>These traits are best used with a hybrid approach (supervised)</li>
</ul>
<h1><a class="anchor" id="autotoc_md12"></a>
Example Fitness Model</h1>
<p>Traits will be compared amongst their common malware family, any traits not common to all samples will be discarded.</p>
<p>Once completed, all remaining traits will be compared to traits from a goodware set, any traits that match the goodware set will be discarded.</p>
<p>To further differ the traits from other malware families, the remaining population will be compared to other malware families, any that match will be discarded.</p>
<p>The remaining population of traits will be unique to the malware family tested and not legitimate binaries or other malware families.</p>
<p>This fitness model allows for accurate classification of the tested malware family.</p>
<h1><a class="anchor" id="autotoc_md13"></a>
Future Work</h1>
<ul>
<li>Java byte-code Support <code>raw:jvm</code>, <code>java:jvm</code></li>
<li>Python byte-code Support <code>raw:pyc</code>, <code>python:pyc</code></li>
<li>More API Endpoints</li>
<li>Cutter, Ghidra and IDA Plugins</li>
<li>Mac-O Support <code>macho:x86_64</code>, <code>macho:x86</code></li>
</ul>
<h1><a class="anchor" id="autotoc_md14"></a>
Contributing</h1>
<p>If you wish to contribute to Binlex DM me on Twitter <a href="https://twitter.com/c3rb3ru5d3d53c">here</a>.</p>
<p>You can also join our Discord <a href="https://discord.gg/UDBfRpxV3B">here</a>.</p>
<p>Currently looking for help on:</p><ul>
<li>MacOS Developer (Parse Mach-O)</li>
<li>Plugin Developers (Python)</li>
<li>Front-End Developers (Python) </li>
</ul>
</div></div><!-- PageDoc -->
</div><!-- contents -->
</div><!-- doc-content -->
<div class="ttc" id="aclassbinlex_1_1Decompiler_html"><div class="ttname"><a href="classbinlex_1_1Decompiler.html">binlex::Decompiler</a></div><div class="ttdef"><b>Definition:</b> decompiler.h:52</div></div>
<div class="ttc" id="aclassbinlex_1_1PE_html"><div class="ttname"><a href="classbinlex_1_1PE.html">binlex::PE</a></div><div class="ttdef"><b>Definition:</b> pe.h:28</div></div>
<div class="ttc" id="aclassbinlex_1_1PE_html_aaf2fa4d79bc0fc9449eadd366b870d6b"><div class="ttname"><a href="classbinlex_1_1PE.html#aaf2fa4d79bc0fc9449eadd366b870d6b">binlex::PE::Setup</a></div><div class="ttdeci">BINLEX_EXPORT bool Setup(MACHINE_TYPES input_mode)</div></div>
<div class="ttc" id="aclassbinlex_1_1File_html_af69581745439422e597e9c8ab2dcb27c"><div class="ttname"><a href="classbinlex_1_1File.html#af69581745439422e597e9c8ab2dcb27c">binlex::File::ReadFile</a></div><div class="ttdeci">bool ReadFile(const char *file_path)</div></div>
<div class="ttc" id="anamespacebinlex_html"><div class="ttname"><a href="namespacebinlex.html">binlex</a></div><div class="ttdoc">the binlex namespace</div></div>
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
